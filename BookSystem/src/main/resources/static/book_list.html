<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ä¹¦åˆ—è¡¨å±•ç¤º</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <link rel="stylesheet" href="css/list.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script src="js/jq-paginator.js"></script>

</head>

<body>
    <div class="bookContainer">
        <h2>å›¾ä¹¦åˆ—è¡¨å±•ç¤º</h2>
        <div class="navbar-justify-between">
            <div>
                <button class="btn btn-outline-info" type="button" onclick="location.href='book_add.html'">æ·»åŠ å›¾ä¹¦</button>
                <button class="btn btn-outline-info" type="button" onclick="batchDelete()">æ‰¹é‡åˆ é™¤</button>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <td>é€‰æ‹©</td>
                    <td class="width100">å›¾ä¹¦ID</td>
                    <td>ä¹¦å</td>
                    <td>ä½œè€…</td>
                    <td>æ•°é‡</td>
                    <td>å®šä»·</td>
                    <td>å‡ºç‰ˆç¤¾</td>
                    <td>çŠ¶æ€</td>
                    <td class="width200">æ“ä½œ</td>
                </tr>
            </thead>
            <tbody id="bookList">
                <tr>
                    <td><input type="checkbox" name="selectBook" value="1" id="selectBook" class="bookInfo-select"></td>
                    <td>1</td>
                    <td>å¤§ç§¦å¸å›½ç¬¬ä¸€å†Œ</td>
                    <td>æˆ‘æ˜¯ä½œè€…</td>
                    <td>23</td>
                    <td>33.00</td>
                    <td>åŒ—äº¬å‡ºç‰ˆç¤¾</td>
                    <td>å¯å€Ÿé˜…</td>
                    <td>
                        <div class="op">
                                <a href="book_update.html?bookId=1">ä¿®æ”¹</a>
                            <a href="javascript:void(0)" onclick="deleteBook(1)">åˆ é™¤</a>
                        </div>
                    </td>
                </tr>

            </tbody>
        </table>

        <div class="demo">
            <ul id="pageContainer" class="pagination justify-content-center"></ul>
        </div>
        <script>

            // getBookList();
            function getBookList(page,callback) {
                $.ajax({
                    url: "/book/GetListByPage",
                    type: "POST",
                    data:{
                        CurrentPage:page,
                        PageSize:10
                    },
                    success: function (result) {
                        console.log(result);
                        //æœªç™»å½•åˆ¤æ–­
                        var data = result.data;
                        if (result == null || result.data == null) {
                            location.href = "login.html";
                            return;
                        }


                        var finalHtml = "";
                        for (var book of data.records) {
                            finalHtml += '<tr>';
                            finalHtml += '<td><input type="checkbox" name="selectBook" value="'+book.id+'" id="selectBook" class="book-select"></td>';
                            finalHtml += '<td>'+book.id+'</td>';
                            finalHtml += '<td>'+book.bookName+'</td>';
                            finalHtml += '<td>'+book.author+'</td>';
                            finalHtml += '<td>'+book.count+'</td>';
                            finalHtml += '<td>'+book.price+'</td>';
                            finalHtml += '<td>'+book.publish+'</td>';
                            finalHtml += '<td>'+book.statusCN+'</td>';
                            finalHtml += '<td><div class="op">';
                            finalHtml += '<a href="book_update.html?bookId='+book.id+'">ä¿®æ”¹</a>';
                            finalHtml += '<a href="javascript:void(0)" onclick="deleteBook('+book.id+')">åˆ é™¤</a>';
                            finalHtml += '</div></td>';
                            finalHtml += "</tr>";
                        }
                        $("tbody").html(finalHtml);
                        if (callback) {
                            callback(data);  // ğŸš€ è¿™é‡Œå¿…é¡»è°ƒç”¨ callbackï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œ
                        }
                    }
                })
            }

            //ç¿»é¡µä¿¡æ¯
            $("#pageContainer").jqPaginator({
                totalCounts: 100, //æ€»è®°å½•æ•°
                pageSize: 10,    //æ¯é¡µçš„ä¸ªæ•°
                visiblePages: 5, //å¯è§†é¡µæ•°
                currentPage: 1,  //å½“å‰é¡µç 
                first: '<li class="page-item"><a class="page-link">é¦–é¡µ</a></li>',
                prev: '<li class="page-item"><a class="page-link" href="javascript:void(0);">ä¸Šä¸€é¡µ<\/a><\/li>',
                next: '<li class="page-item"><a class="page-link" href="javascript:void(0);">ä¸‹ä¸€é¡µ<\/a><\/li>',
                last: '<li class="page-item"><a class="page-link" href="javascript:void(0);">æœ€åä¸€é¡µ<\/a><\/li>',
                page: '<li class="page-item"><a class="page-link" href="javascript:void(0);">{{page}}<\/a><\/li>',
                //é¡µé¢åˆå§‹åŒ–å’Œé¡µç ç‚¹å‡»æ—¶éƒ½ä¼šæ‰§è¡Œ
                onPageChange: function (page, type) {
                    getBookList(page,function(result){
                        console.log(result.total)
                        console.log("totalCounts:"+this.totalCounts+",pageSize:"+this.pageSize)
                        this.totalCounts = result.total
                        this.visiblePages = Math.ceil(this.totalCounts / this.pageSize)+1

                        //åŠ¨æ€æ›´æ–°
                        $("#pageContainer").jqPaginator("option", {
                            totalCounts: this.totalCounts,
                            visiblePages: this.visiblePages
                        });
                    }.bind(this))
                    console.log("ç¬¬" + page + "é¡µ, ç±»å‹:" + type);
                }
            });


            function deleteBook(id) {
                var isDelete = confirm("ç¡®è®¤åˆ é™¤?");

                $.ajax({
                    url:"book/deleteBook"+"?id="+id,
                    type: "GET",
                    success:function (response){
                        alert(response)
                        getBookList()
                    },
                    error:function (response){
                        alert(response)
                    }
                })

            }
            function batchDelete() {
                var isDelete = confirm("ç¡®è®¤æ‰¹é‡åˆ é™¤?");
                if (isDelete) {
                    //è·å–å¤é€‰æ¡†çš„id
                    var ids = [];
                    $("input:checkbox[name='selectBook']:checked").each(function () {
                        ids.push($(this).val());
                    });
                    console.log(ids);

                    $.ajax({
                        url:"book/batchDelBook",
                        type:"post",
                        data: {
                            ids:ids
                        },
                        success:function (response){
                            alert("æ‰¹é‡åˆ é™¤æˆåŠŸ");
                        },
                        error:function (){
                            alert("æ‰¹é‡åˆ é™¤å¤±è´¥");
                        }
                    })
                }
            }

        </script>
    </div>
</body>

</html>